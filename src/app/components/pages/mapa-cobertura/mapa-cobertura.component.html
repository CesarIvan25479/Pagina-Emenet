<div class="content">
  <h1 class="text-4xl line-height-1 sm:text-5xl font-bold border titulos text-center"
   pAnimateOnScroll enterClass="zoomindown animation-duration-1000" >Mapa de cobertura</h1>
  <div class="grid" id="mapa-cobertura">
    <div class="col-12 md:col-5 flex align-items-center" pAnimateOnScroll enterClass="fadeinleft animation-duration-1000">
      <div class="card shadow-4 border-round-2xl p-6 surface-0 border-1 border-200 tarjeta-ios">
        <h2 class="text-2xl font-semibold mb-3 text-900">¿Nuestros servicios están disponibles en tu zona?</h2>
        <p class="text-sm text-600 mb-5 leading-relaxed">
          Ingresa tu <span class="font-medium text-primary">colonia, municipio o coordenadas</span> o 
          <span class="font-medium text-primary">selecciona en el mapa</span> para verificar nuestra cobertura.
        </p>
        <form [formGroup]="formUbicacion" (ngSubmit)="buscarZonas()" class="flex flex-column gap-3">
          <div class="relative">
            <input
              type="text"
              pInputText
              formControlName="ubicacion"
              id="search-input"
              placeholder="Ej: Tianguistenco, 19.017108, -99.403604"
              class="w-full p-3 text-sm border-200 hover:border-300 focus:border-primary transition-colors campo-ios"
              style="border-radius: 12px;"
            />
            <button
              pButton
              (click)="colocarUbicacion()"
              type="button"
              icon="pi pi-map-marker"
              class="absolute right-2 top-1/2 -translate-y-1/2 p-button-rounded p-button-text p-button-plain"
              style="width: 44px; height: 44px; font-size: 1.25rem;"
              aria-label="Icono ubicación"
              tabindex="-1"
            ></button>
          </div>
          <button 
            pButton 
            type="submit" 
            [icon]="progreso ? 'pi pi-spin pi-spinner' : 'pi pi-search'" 
            [disabled]="progreso"
            label="Verificar cobertura" 
            class="w-full p-button-primary boton-ios"
            style="border-radius: 12px;"
          ></button>
          <div class="nota-ios mt-2">
            <i class="pi pi-info-circle"></i>
            <small>La disponibilidad mostrada es referencial. Validamos técnicamente antes de instalar.</small>
          </div>
          <small class="text-blue-900 font-semibold block " *ngIf="!resultadosBusqueda?.length && busquedaActiva && !errorBusqueda">No se encontraron resultados</small>
          <small class="text-red-900 font-semibold block " *ngIf="errorBusqueda && busquedaActiva">Ha ocurrido un error al hacer la búsqueda</small>

          <div *ngIf="resultadosBusqueda?.length" class="bg-blue-50 border-1 border-blue-200 p-3 rounded-md">
            <small class="text-blue-900 font-semibold block mb-2">Resultados sugeridos:</small>
            <div class="flex flex-column gap-2 overflow-scroll" style="max-height: 120px">
              <div *ngFor="let result of resultadosBusqueda; let i = index" class="flex align-items-center gap-2 ">
                <input type="radio" [value]="i" name="location" [id]="'location' + i" (change)="seleccionUbicacion(i)" />
                <label [for]="'location' + i" class="text-xs text-blue-900 cursor-pointer hover:text-primary transition-colors">
                  {{ result.display_name }}
                </label>
              </div>
            </div>
          </div>
        </form>

        <p class="text-xs text-bluegray-500 italic mt-4 border-left-2 pl-3 border-cyan-700">
          *Nota: La disponibilidad mostrada es referencial. Es necesario realizar una validación técnica para confirmar la factibilidad del servicio en tu domicilio.
        </p>
      </div>
    </div>
    <div class="col-12 md:col-7"  pAnimateOnScroll enterClass="fadeinright animation-duration-1000">
      <div class="card shadow-2 border-round overflow-hidden">
        <div id="map" style="height: 580px; width: 100%;"></div>
      </div>
    </div>
  </div>
</div>
<p-dialog [modal]="true" [(visible)]="verMensaje" [style]="{ width: '28rem' }" styleClass="dialogo-ios">
  <div class="flex flex-column align-items-center justify-content-center text-center fadein animation-duration-1000 p-4">
    <!-- Icono con animación -->
    <div class="icono-contenedor-ios mb-3" [ngClass]="{ 'icono-exito': cobertura, 'icono-error': !cobertura }">
      <i class="pi" [ngClass]="{ 'pi-check-circle': cobertura, 'pi-times-circle': !cobertura }"></i>
    </div>

    <!-- Título -->
    <h2 class="text-2xl font-semibold mb-2 text-900">
      {{ cobertura ? '¡Excelente noticia!' : 'Sin cobertura en esta ubicación' }}
    </h2>

    <!-- Descripción -->
    <p class="text-sm text-600 mb-4 leading-relaxed" style="max-width: 22rem;">
      {{ cobertura ? 'Contamos con cobertura en tu zona. Explora nuestros planes y elige el que mejor se adapte a tus necesidades.' : 'No encontramos cobertura en el mapa actual, pero podrías estar cerca de una zona con señal. Contáctanos para una validación técnica.' }}
    </p>

    <!-- Botones -->
    <div class="w-full flex flex-column gap-2">
      <button 
        pButton 
        type="button" 
        [disabled]="progreso" 
        (click)="router.navigate(['/planes'])" 
        label="Ver planes disponibles" 
        class="w-full boton-primario-ios"
        *ngIf="cobertura"
      ></button>
      
      <button 
        pButton 
        type="button"
        icon="pi pi-whatsapp" 
        label="Contactar asesor" 
        (click)="$event.stopPropagation(); abrirWhatsApp()"
        class="w-full boton-whatsapp-ios"
        *ngIf="!cobertura"
      ></button>
    </div>
  </div>
</p-dialog>
